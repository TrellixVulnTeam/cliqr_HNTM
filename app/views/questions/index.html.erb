<script src="http://code.highcharts.com/highcharts.js" type="text/javascript"></script>
<script>
  $('#upvote').click(function(){
  	console.log("upvote clicked")
  });

  $('#downvote').click(function(){
  	console.log("downvote clicked")
  });

  var categories = <%= @categories %>;

  $(function () {
    $('#container-x').highcharts({
        chart: {
            type: "spline",
        },
        credits: {
        	enabled: false
        },
        legend: {
        	enabled: false
        },
        plotOptions: {
            series: {
                marker: {
                    enabled: false
                }    
            }
        },
        title: {
            text: 'Cluelesses',
            x: -20 //center
        },
        xAxis: {
            categories: categories.map(function(x) {return x + ":00"}),
            lineWidth: 0,
            tickLength: 0
        },
        yAxis: {
            plotLines: [{
                value: 0,
                width: 0,
                color: '#808080'
            }],
            gridLineWidth: 0,
            title: {
            	text: null
            }
        },
        // legend: {
        //     layout: 'vertical',
        //     align: 'right',
        //     verticalAlign: 'middle',
        //     borderWidth: 0
        // },
        series: [{
            // name: 'Tokyo',
            data: <%= @data %>,
            name: "Cluelesses"
        }]
    });
});

</script>
<h1 id="title">Lecture Questions</h1>

<div id="container-x" style="min-width: 310px; height: 500px; margin: 0 5%"> <%= @data %></div>

<h2 id="newQlink">
	<%= link_to "Add new Question", new_question_path %>
</h2><br>
<% @questions.each do |question| %>
	
	<div class="quest">
	  <div class="span1">
	  	<%= form_for @vote, {url: question_votes_path(question) } do |f| %>
    		<%= f.hidden_field :vote_type, value: 'upvote' %>
	    <button type="submit" id="upvote" class="btn btn-sm btn-success btn-upvote">
	      <span class="glyphicon glyphicon-arrow-up"></span>&nbsp;
	    </button><br>
    	<% end %>
	    <span class="count"><%= question.upvote - question.downvote %></span><br>
	    <%= form_for @vote, {url: question_votes_path(question) } do |f| %>
    		<%= f.hidden_field :vote_type, value: 'downvote' %>
	    <button type="submit" id="downvote" class="btn btn-sm btn-danger btn-downvote">
	      <span class="glyphicon glyphicon-arrow-down"></span>&nbsp;
	    </button>
    	<% end %>
	  </div>
	  <div class="span8 question">
	  	<b><%= "Teacher Vetted:" if question.vetted == true %></b>
	    <pre><%= link_to question.text, question_path(question) %></pre>
	    <%= form_for question, {url: question_vet_path(question)} {|f| f.submit 'Vet Question', class: "vet-button" } if current_user.presenter == true %>
	  </div>
	</div>

	<% @answers.where(question_id:question.id).order('upvote - downvote DESC').each do |answer| %>

		<div class="ans">
		  <div class="span1">
		  	<%= form_for @vote, {url: answer_votes_path(answer) } do |f| %>
      			<%= f.hidden_field :vote_type, value: 'upvote' %>
		    <button type="submit" id="upvote" class="btn btn-sm btn-success btn-upvote">
		      <span class="glyphicon glyphicon-arrow-up"></span>&nbsp;
		    </button><br>
		    <% end %>
		    <span class="count"><%= answer.upvote - answer.downvote %></span><br>
		    <%= form_for @vote, {url: answer_votes_path(answer) } do |f| %>
      			<%= f.hidden_field :vote_type, value: 'downvote' %>
		    <button type="submit" id="downvote" class="btn btn-sm btn-danger btn-downvote">
		      <span class="glyphicon glyphicon-arrow-down"></span>&nbsp;
		    </button>
		    <% end %>
		  </div>
		  <div class="span6 answer">
		  	<b><%= "Teacher Vetted:" if answer.vetted == true %></b>
		    <pre><%= answer.text %></pre>
		    <%= form_for answer, {url: answer_vet_path(answer)} {|f| f.submit 'Vet Answer', class: "vet-button"  } if current_user.presenter == true %>
		  </div>
		</div>

	<% end %>
	

<% end %>

<style>
.vet-button {
	float: right;
}
</style>

<script>
  $('#upvote').click(function(){
  	console.log("upvote clicked")
  });

  $('#downvote').click(function(){
  	console.log("downvote clicked")
  });

</script>
